# $Id: Makefile,v 1.14 2005/06/21 11:48:13 hal Exp $
#
# Makefile for the qmmm_md sources
#



SHELL	= /bin/sh
RM	= rm -f

# version and build information
KERNEL	= `uname -s`
MACHINE	= `uname -m`
VERSION = `cat .version`
HOSTNAME = `hostname`
BUILD_DATE = `date`

# directories
SRCDIR = .
INCLUDEDIR = $(SRCDIR)/include
UTILDIR = $(SRCDIR)/util

# program to generate dependencies from include files
F77MAKEDEP = ../tools/f77makedep


A2PS    = a2ps -C -E -f7 --right-footer="Qion"
A2PS_OUTPUT_OPTION = -o $@


FOBJS_	= prmini.o main.o rdinp.o cmdlin.o getmas.o pinit.o rfinit.o pbcmic.o\
	  nbrwt.o nbrion.o nbratb.o nbraHH.o nbraOH.o nbraOO.o nbrlst.o qmlist.o\
	  potfor.o pfwtoo.o pfwtoh.o pfwthh.o pfintr.o pf2bd.o pfrf.o pf3bdc.o\
	  qmmm.o wrstat.o scalex.o momz.o bath.o pbath.o rstart.o wrtraj.o\
	  finish.o pred.o corr.o vverl1.o vverl2.o umbpot.o umbst.o setup.o\
	  $(UTILDIR)/prslin.o $(UTILDIR)/tcase.o $(UTILDIR)/ssum.o\
	  $(UTILDIR)/lentrm.o $(UTILDIR)/lfttrm.o
FOBJS	= $(FOBJS_) wrout.o
FSRCS_	= $(FOBJS_:.o=.f)
FSRCS	= $(FOBJS:.o=.f)

COBJS	= $(UTILDIR)/fsys.o
CSRCS	= $(COBJS:.o=.c)

INCS	= $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/consts.inc\
	  $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/eqmot.inc\
	  $(INCLUDEDIR)/files.inc $(INCLUDEDIR)/qmmm.inc\
	  $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/neighb.inc\
	  $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc\
	  $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/rfpot.inc\
	  $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/sizes.inc\
	  $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/umbrella.inc\
	  $(INCLUDEDIR)/units.inc


.SUFFIXES:
.SUFFIXES: .o .f .c

# built into many versions of make but some implementations are too dumb
.f.o:
	$(FC) -I$(INCLUDEDIR) $(FFLAGS) -c $< -o $@
.c.o:
	$(CC) $(CFLAGS) $(CPPFLAGS) -c $< -o $@


all: $(PROGRAM)

.PHONY: dep ps check clean distclean


$(PROGRAM): $(FOBJS) $(COBJS)
	$(FC) $(FFLAGS) $(FOBJS) $(COBJS) -o $@ $(LDFLAGS)

wrout.f: _wrout.f .version $(FOBJS_) $(COBJS)
	@sed -e "s/@KERNEL@/$(KERNEL)/"\
	     -e "s/@MACHINE@/$(MACHINE)/"\
	     -e "s/@VERSION@/$(VERSION)/"\
	     -e "s/@HOST@/$(HOSTNAME)/" \
	     -e "s/@DATE@/$(BUILD_DATE)/" _wrout.f > $@

dep:
	$(F77MAKEDEP) _wrout.f $(FSRCS_)


ps: _wrout.f.ps $(FSRCS_:.f=.f.ps) $(CSRCS:.c=.c.ps)

# GNU make pattern rules
%.f.ps: %.f
	$(A2PS) $(A2PS_OUTPUT_OPTION) $<

%.inc.ps: %.inc
	$(A2PS) $(A2PS_OUTPUT_OPTION) $<

%.c.ps: %.c
	$(A2PS) $(A2PS_OUTPUT_OPTION) $<


# ftnchek
check:
	@ftnchek -quiet -version -nonovice -declare -nopure -common=all\
          -pretty=all -usage=no-ext-undefined,no-com-block-unused -f95=all\
	  -f77=all,no-implicit-none,no-do-enddo,no-include,no-long-names,no-namelist,no-internal-list-io\
	  -portability=all,no-long-string -intrinsic=no-extra,no-unix\
	  -include=$(INCLUDEDIR) $(FSRCS_) _wrout.f

ref: ref.lis
ref.lis:
	@ftnchek -nocheck -calltree=reference,no-sort -output=ref\
	  -include=$(INCLUDEDIR) -quiet $(FSRCS_) _wrout.f

tree: tree.lis
tree.lis:
	@ftnchek -nocheck -calltree=tree,no-sort -output=tree\
	  -include=$(INCLUDEDIR) -quiet $(FSRCS_) _wrout.f

symtab: symtab.lis
symtab.lis:
	@ftnchek -nocheck -symtab -output=symtab\
	  -include=$(INCLUDEDIR) -quiet $(FSRCS_) _wrout.f


# cleanup
clean:
	$(RM) $(FOBJS) $(COBJS) *.o *.il wrout.f *.ps $(INCLUDEDIR)/*.ps\
	      $(UTILDIR)/*.ps *.lis *.vcg *~ core

distclean: clean
	$(RM) $(PROGRAM)


# dependencies
qmmm.o: $(UTILDIR)/fsys.o
cmdlin.o: $(UTILDIR)/lentrm.o
finish.o: $(UTILDIR)/lentrm.o
qmmm.o: $(UTILDIR)/lentrm.o
main.o: $(UTILDIR)/lentrm.o
rdinp.o: $(UTILDIR)/lentrm.o
wrout.o: $(UTILDIR)/lentrm.o
setup.o: $(UTILDIR)/lentrm.o
$(UTILDIR)/prslin.o: $(UTILDIR)/lentrm.o
momz.o: $(UTILDIR)/ssum.o
wrstat.o: $(UTILDIR)/ssum.o
getmas.o: $(UTILDIR)/tcase.o
rdinp.o: $(UTILDIR)/prslin.o
wrout.o: $(UTILDIR)/lfttrm.o

corr.o: pbcmic.o
pred.o: pbcmic.o
qmmm.o: pbcmic.o
nbrwt.o: pbcmic.o
nbrion.o: pbcmic.o
nbraHH.o: pbcmic.o
nbraOH.o: pbcmic.o
nbraOO.o: pbcmic.o
nbrlst.o: pbcmic.o
qmlist.o: pbcmic.o
pf2bd.o: pbcmic.o
pfintr.o: pbcmic.o
pfrf.o: pbcmic.o
pfwthh.o: pbcmic.o
pfwtoh.o: pbcmic.o
pfwtoo.o: pbcmic.o
pf3bdc.o: pbcmic.o
umbpot.o: pbcmic.o
umbst.o: pbcmic.o


# --- automatically generated by f77makedep, do not edit ---
_wrout.o: $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/umbrella.inc $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
prmini.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/umbrella.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/files.inc
main.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/stpcnt.inc
rdinp.o: $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/qmmm.inc $(INCLUDEDIR)/umbrella.inc $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
cmdlin.o: $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
pinit.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/consts.inc
rfinit.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/rfpot.inc $(INCLUDEDIR)/consts.inc
pbcmic.o: $(INCLUDEDIR)/params.inc
nbrwt.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc
nbrion.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc
nbratb.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/neighb.inc
nbraHH.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc
nbraOH.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc
nbraOO.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc
nbrlst.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc
qmlist.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/qmmm.inc
potfor.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/rfpot.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc
pfwtoo.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/qmmm.inc
pfwtoh.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/qmmm.inc
pfwthh.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/neighb.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/qmmm.inc
pfintr.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/qmmm.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc
pf2bd.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/qmmm.inc
pfrf.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc
pf3bdc.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/qmmm.inc $(INCLUDEDIR)/press.inc
qmmm.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/qmmm.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/neighb.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
wrstat.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
scalex.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/units.inc
momz.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc
bath.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/units.inc
pbath.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/press.inc
rstart.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
wrtraj.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
finish.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
pred.o: $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/rvf.inc
corr.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/rvf.inc
vverl1.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/rvf.inc
vverl2.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/rvf.inc
umbpot.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/umbrella.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/consts.inc
umbst.o: $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/umbrella.inc $(INCLUDEDIR)/stpcnt.inc $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/rvf.inc $(INCLUDEDIR)/energy.inc $(INCLUDEDIR)/files.inc $(INCLUDEDIR)/units.inc
setup.o: $(INCLUDEDIR)/sizes.inc $(INCLUDEDIR)/params.inc $(INCLUDEDIR)/potfor.inc $(INCLUDEDIR)/qmmm.inc $(INCLUDEDIR)/intra.inc $(INCLUDEDIR)/press.inc $(INCLUDEDIR)/eqmot.inc $(INCLUDEDIR)/atoms.inc $(INCLUDEDIR)/consts.inc $(INCLUDEDIR)/units.inc $(INCLUDEDIR)/files.inc
